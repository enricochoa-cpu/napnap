# 2026-02-20 — Spanish + English i18n

## Summary

- **i18n**: Added `i18next` and `react-i18next`; bootstrap in `main.tsx` (import `./i18n`). Initial language from `localStorage` key `STORAGE_KEYS.LOCALE`; overridden by `profiles.locale` when user profile loads.
- **Locale files**: `src/locales/en.json` and `src/locales/es.json` with namespaced keys (auth, onboarding, today, nav, profile, report, faq, etc.).
- **DB**: Migration `20260220000000_add_profiles_locale.sql` adds `profiles.locale` (text, default `'en'`). **Run the migration** (e.g. `supabase db push` or apply via dashboard) so persisted language works.
- **Types**: `UserProfile.locale?: 'en' | 'es'`; `DbProfile.locale`.
- **useBabyProfile**: On fetch, applies `data.locale` to i18n and `localStorage`. On update, persists `locale` and calls `i18n.changeLanguage(locale)`.
- **Settings**: Language selector in AccountSettingsView (English / Español) calling `onUpdateUser({ locale })`.
- **Report**: `reportData` returns translation keys + params for tips and copy; SleepReportView uses `t(key, params)`. Date range label uses `getDateFnsLocale()` for localized month names.
- **FAQs**: FAQsView renders from `t(\`faq.${id}.question\`)` and `t(\`faq.${id}.answer\`)`; FAQ content lives in locale JSON.
- **date-fns**: `src/utils/dateFnsLocale.ts` returns `es` or `enUS` from `date-fns/locale` based on `i18n.language`; used in reportData for `dateRangeLabel`.

## Components translated

Auth (LoginForm, SignUpForm, ForgotPasswordForm, GoogleSignInButton, AuthDivider), EntryChoice, OnboardingFlow, App (nav aria-labels), ProfileMenu, AccountSettingsView (full + Language block), QuickActionSheet, SleepReportView (full), FAQsView (key-based), MissingBedtimeModal, TodayView (greeting/add-baby copy). Other screens (TodayView remaining strings, SleepList, DayNavigator, SleepEntrySheet, WakeUpSheet, ActivityCollisionModal, StatsView, MyBabiesView, BabyEditSheet, ShareAccess, SupportView, ContactView, PrivacyPolicyView, LoadingScreen) can be wired to `t()` using existing keys in en.json/es.json or by adding keys as needed.

## Language selector fix (same day)

- **Issue:** Language selector in Account settings did nothing when tapping English/Español.
- **Cause:** `updateProfile()` ran the Supabase upsert first; on failure (e.g. migration not run) it returned before updating i18n or `userProfile`.
- **Fix:** Apply locale optimistically at the start of `updateProfile()`: i18n + localStorage + setUserProfile, then upsert. Selector works even if DB lacks `profiles.locale`. See lessons.md §2.3.

## Lint

Existing lint rules (refs during render, setState in effect) still report in App.tsx, ProfileSection, AccountSettingsView, MyBabiesView; not introduced by i18n.
