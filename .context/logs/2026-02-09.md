# 2026-02-09 — Baby Profile Redesign + SleepEntrySheet Polish

## Cambios Realizados

### 1. Unified Interactive Baby Card (`MyBabiesView.tsx`)
- Added `active:brightness-[1.12]` to `BabyProfileCard` and `AddBabyGhostCard` for immediate pressed-state feedback
- Moved "Tap to edit" hint inline under age text for **all** owned babies (not just non-active)
- Removed right-side "Tap to edit" text (now redundant with inline hint)

### 2. Baby Management Flow Redesign
Replaced the `BabyEditSheet` bottom sheet with a dedicated full-screen `BabyDetailView` for editing owned babies. Bottom sheet is now only used for the "Add Baby" flow.

**New file:** `src/components/Profile/BabyDetailView.tsx`
- Full-screen view with `SubViewHeader` (baby name + age)
- Section 1: Avatar + profile form (name, DOB, gender, weight, height) — form fields reused from `BabyEditSheet`
- Section 2: `ShareAccess` component (owners only) — moved here from `MyBabiesView`
- Save button only visible when form has changes
- Delete baby link at bottom (owners only)
- Non-owners see read-only fields (disabled inputs)

**Routing changes (`ProfileSection.tsx`):**
- Added `'baby-detail'` to `ProfileView` type
- Added `selectedBabyId` state to track which baby is being edited
- Added `handleNavigateToBabyDetail(babyId)` — sets direction forward, navigates to `'baby-detail'`
- Added `handleBackFromBabyDetail()` — sets direction backward, returns to `'my-babies'`
- Added AnimatePresence block for the new view with slide transitions

**MyBabiesView changes:**
- Owned baby card click → `onNavigateToBabyDetail(baby.id)` (full-screen) instead of opening `BabyEditSheet`
- Removed `ShareAccess` section (now lives in `BabyDetailView`)
- `BabyEditSheet` kept only for "Add Baby" ghost card flow
- Removed unused sharing imports

### 3. SleepEntrySheet Temporal Validation
Added duration validation to prevent saving impossible sleep entries.

**New helpers:**
- `computeDurationMinutes(start, end)` — returns numeric minutes (handles cross-midnight)

**Validation rules:**
| Scenario | Nap | Night |
|----------|-----|-------|
| start === end (0 duration) | Block | Block |
| Duration > 5h (nap) / 14h (night) | Block | Block |
| Duration > 4h (nap) / 13h (night) | Amber warning | Amber warning |
| Cross-midnight | Warn (allow save) | Normal (expected) |

**UI:**
- Error text in `--danger-color`, warning text in `--wake-color`, displayed below time inputs
- "Ends next day" hint suppressed when validation error/warning is shown
- Save button disabled when `!validation.isValid`

### 4. SleepEntrySheet Visual & Functional Polish

**4.1 — Alignment fixes:**
- Changed time input parent flex from `items-center` to `items-start` (top-aligned)
- Arrow separator: removed `pb-5`, added `pt-2` (aligns with time input text)
- Label margin increased from `mt-1` to `mt-2`

**4.2 — Delete icon visibility:**
- Changed from `text-[var(--text-muted)]/60` to `text-[var(--text-muted)]` (full opacity, was too faint)

**4.3 — Dynamic relative labels:**
- Added `now` state with 30-second refresh interval (only while sheet is open)
- Added `getRelativeAgo(timeStr, dateStr, now)` helper
- Start label: shows duration when end time exists, else "Start"/"Bedtime"
- End label: shows relative "ago" when end time exists, "Sleeping..." for active entries, else "End"/"Wake up"
- Removed standalone duration section — duration now lives under start label

**4.4 — Play/Stop/Check icon states:**
- New `PlayIcon` (filled triangle) — new entry with no end time
- New `StopIcon` (filled rounded square) — editing active entry (no end time)
- `CheckIcon` (tick) — entries with end time or editing completed entries

| State | Icon |
|-------|------|
| New entry, no end time | Play (triangle) |
| New entry, with end time | Check (tick) |
| Editing active entry (no end) | Stop (square) |
| Editing completed entry | Check (tick) |

## Decisiones Arquitecturales

### Full-Screen Detail View over Bottom Sheet for Editing
**Decision:** Owned babies now navigate to a full-screen `BabyDetailView` instead of opening `BabyEditSheet`. The bottom sheet is retained only for the "Add Baby" quick flow.
**Rationale:** The baby edit form + sharing management is too much content for a bottom sheet. A full-screen view provides:
- Space for the ShareAccess section alongside profile fields
- Better scrolling behaviour for long forms
- Clearer spatial hierarchy (drill-in navigation vs overlay)

### Temporal Validation as Client-Side Guard
**Decision:** Validation is purely client-side with no server enforcement.
**Rationale:** The rules (max 5h nap, max 14h night) are UX guardrails, not data integrity constraints. Cross-midnight naps are warned but allowed because late-evening naps for older infants are legitimate.

## Pendientes

- [ ] Delete Account button is a TODO (does nothing)
- [ ] Resend domain verification for production invitation emails
- [ ] Delete baby functionality (currently shows confirmation but doesn't delete)
