# 2026-02-05 - Baby Profile Pictures & Share Access UX

## Features Implemented

### 1. Baby Profile Pictures
- **New component**: `BabyAvatarPicker` with three sizes (sm: 48px, md: 80px, lg: 120px)
- **Client-side image compression**: Resizes any image to 400x400 max, JPEG 80% quality (~50-150KB output)
- **Supabase Storage integration**: Uses `baby-avatars` bucket with user folder structure
- **Display locations**: Baby switcher list (sm), profile details (lg, editable)

### 2. Share Access Role System
- **Role selector on invite**: Caregiver (can edit) vs Viewer (read-only)
- **Edit existing shares**: Tap person → bottom sheet with role selector + remove option
- **Bottom sheet pattern**: Consistent with other sheets in app, uses Framer Motion spring animation
- **Constrained width**: Bottom sheet uses `max-w-lg` to match nav bar width

### 3. Shared User Permissions Fix
- **Issue**: Shared users couldn't edit entries (RLS blocked them)
- **Solution**: Updated Supabase RLS policies for `sleep_entries` table to check `baby_shares`
- **Roles respected**: Only caregivers can insert/update/delete; viewers can only read

## Technical Changes

### New Files
- `src/components/Profile/BabyAvatarPicker.tsx` - Reusable avatar picker with compression

### Modified Files
- `src/types/index.ts` - Added `avatarUrl` to BabyProfile
- `src/lib/supabase.ts` - Added `baby_avatar_url` to DbProfile
- `src/hooks/useBabyProfile.ts` - Added `uploadBabyAvatar`, handle avatarUrl in CRUD
- `src/hooks/useBabyShares.ts` - Added `updateShareRole` function
- `src/components/ShareAccess.tsx` - Role selector UI, bottom sheet for editing
- `src/components/Profile/MyBabiesView.tsx` - Integrated BabyAvatarPicker
- `src/components/Profile/ProfileSection.tsx` - Prop pass-through for avatar/role
- `src/App.tsx` - Wire up new functions

## Supabase Setup Required

### Storage Bucket
```
Name: baby-avatars
Public: Yes
File size limit: 2MB
Allowed MIME types: image/jpeg, image/png, image/webp
```

### Database Migration
```sql
ALTER TABLE profiles ADD COLUMN baby_avatar_url TEXT;
```

### RLS Policies for sleep_entries (shared users)
```sql
-- Allow caregivers to read/write entries for shared babies
-- See full SQL in conversation
```

### RLS Policy for baby_shares
```sql
CREATE POLICY "Owners can update their shares" ON baby_shares
FOR UPDATE USING (baby_owner_id = auth.uid());
```

## Design Decisions
- **Bottom sheet for editing**: Chosen over inline editing for cleaner list UI and native mobile feel
- **Image compression**: Client-side to avoid friction; users can upload any size photo
- **Role descriptions**: "Can add and edit entries" vs "Can only view entries" for clarity

### 4. Profile "Parental Command Center" Redesign
- **Identity Header**: Time-based greeting ("Good morning, [Name]") with encouraging message
- **Primary Baby Card**: Large card with baby avatar (120px), name, age, and calibration ring
- **Calibration Ring**: SVG progress indicator showing algorithm status (Learning/Calibrating/Optimised)
- **Premium Nested List**: Single-column list with grouped sections (General, Help, Account)
- **Nested Support View**: FAQs and Contact Us consolidated under "Support" (Decision Compression)
- **Empty State**: Inviting card with gradient background when no babies added
- **Pending Invitations**: Prominent placement at top with gradient background

### Design Pattern: "Premium Nested List" with Glassmorphism
- Replaced 2x2 grid with Napper-style single-column list
- Each row: icon (left) → title + subtitle (center) → chevron (right)
- **Removed section headers** - spacing creates implied groups
- **Glassmorphism styling**: `bg-white/[0.08]`, `backdrop-blur-xl`, `border-white/10`
- **Shadow depth**: `shadow-[0_8px_30px_rgb(0,0,0,0.04)]`
- **Status Pill**: Premium button with Sparkles icon, opens AlgorithmStatusCard
- **Inline Support Expand**: ChevronDown toggles FAQs/Contact sub-items in place
- **SubRow component**: Smaller, indented rows for nested navigation

## Design Philosophy (AAA Standard)
- **Decision Replacement**: Profile is now a "Command Center" not a settings page
- **Decision Compression**: FAQs + Contact consolidated into single "Support" entry
- **Calming**: Uses `rounded-2xl`, backdrop blur, soft shadows
- **Parent-Centric**: Greeting addresses parent by name, shows encouragement
- **Visual Hierarchy**: Baby card is prominent; navigation is clean single-column; algorithm details at bottom

### 5. Global AAA-Design Overhaul
- **Glassmorphism everywhere**: `bg-white/[0.06-0.08]`, `backdrop-blur-xl`, `border-white/10`
- **Shadow depth**: `shadow-[0_8px_30px_rgb(0,0,0,0.06)]`
- **TodayView Hero Card**: Wrapped countdown in glass card with LiveStatusPill
- **Timeline Cards**: Updated all cards to `rounded-2xl` with glassmorphism
- **StatsView**: Added insight tags, glass cards for summary and charts
- **SupportView**: Dedicated route with glass ListRows

### Visual Specs Applied Globally
- **Shadows**: `shadow-[0_8px_30px_rgb(0,0,0,0.06)]`
- **Borders**: `border border-white/10`
- **Backgrounds**: `bg-white/[0.06]` with `backdrop-blur-xl`
- **Icons**: strokeWidth 1.5 for premium feel
- **No 2x2 grids**: Single-column lists with `gap-4` spacing

### 6. Account Settings Cleanup
- **Sign Out button**: Standalone glassmorphism card with soft red tint (`bg-white/[0.08]`, `text-red-400`)
- **Delete Account**: Moved to very bottom as subtle `text-xs opacity-50` text link with `mt-8` spacing
- **Removed Preferences section**: No more "Notifications - Coming soon" placeholder

### 7. Premium AAA Gallery for My Babies
- **BabyProfileCard component**: Floating cards with `rounded-[40px]` organic corners
- **BabyEditSheet component**: Bottom sheet for editing (replaces full-view swap)
- **Spatial continuity**: Gallery stays visible while edit sheet slides up from bottom
- **Edit button overlay**: Small circular button on owned baby cards
- **Quick Info summary**: Compact 3-column grid showing gender/weight/height
- **AddBabyGhostCard**: Dashed border invitation to add another baby

### Design Pattern: "Edit Sheet" (Spatial Continuity)
- **Problem**: Full-view swaps feel jarring ("raro") and lose context
- **Solution**: Bottom sheet overlay keeps gallery visible in background blur
- **Animation**: `framer-motion` spring (damping: 25, stiffness: 300)
- **Drag-to-dismiss**: Swipe down to close with elastic physics
- **Form grouping**: Inputs grouped in `rounded-3xl` glass cards

### Bug Fix: Shared Profile Avatar
- **Issue**: Shared users couldn't see baby's profile picture
- **Root cause**: `baby_avatar_url` missing from Supabase select query in `useBabyProfile.ts`
- **Fix**: Added `baby_avatar_url` to the profiles join in shared babies query

## Commits
1. `feat: add baby profile picture with client-side image compression`
2. `feat: add role selector (caregiver/viewer) when inviting users`
3. `feat: allow editing roles for existing shared users`
4. `feat: improve share access UI with bottom sheet pattern`
5. `feat: redesign profile as Parental Command Center with calibration ring`
6. `feat: global AAA-design overhaul with glassmorphism`
7. `feat: premium AAA gallery for My Babies with edit sheet transition`
