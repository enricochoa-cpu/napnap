# 2026-02-05 - Baby Profile Pictures & Share Access UX

## Features Implemented

### 1. Baby Profile Pictures
- **New component**: `BabyAvatarPicker` with three sizes (sm: 48px, md: 80px, lg: 120px)
- **Client-side image compression**: Resizes any image to 400x400 max, JPEG 80% quality (~50-150KB output)
- **Supabase Storage integration**: Uses `baby-avatars` bucket with user folder structure
- **Display locations**: Baby switcher list (sm), profile details (lg, editable)

### 2. Share Access Role System
- **Role selector on invite**: Caregiver (can edit) vs Viewer (read-only)
- **Edit existing shares**: Tap person â†’ bottom sheet with role selector + remove option
- **Bottom sheet pattern**: Consistent with other sheets in app, uses Framer Motion spring animation
- **Constrained width**: Bottom sheet uses `max-w-lg` to match nav bar width

### 3. Shared User Permissions Fix
- **Issue**: Shared users couldn't edit entries (RLS blocked them)
- **Solution**: Updated Supabase RLS policies for `sleep_entries` table to check `baby_shares`
- **Roles respected**: Only caregivers can insert/update/delete; viewers can only read

## Technical Changes

### New Files
- `src/components/Profile/BabyAvatarPicker.tsx` - Reusable avatar picker with compression

### Modified Files
- `src/types/index.ts` - Added `avatarUrl` to BabyProfile
- `src/lib/supabase.ts` - Added `baby_avatar_url` to DbProfile
- `src/hooks/useBabyProfile.ts` - Added `uploadBabyAvatar`, handle avatarUrl in CRUD
- `src/hooks/useBabyShares.ts` - Added `updateShareRole` function
- `src/components/ShareAccess.tsx` - Role selector UI, bottom sheet for editing
- `src/components/Profile/MyBabiesView.tsx` - Integrated BabyAvatarPicker
- `src/components/Profile/ProfileSection.tsx` - Prop pass-through for avatar/role
- `src/App.tsx` - Wire up new functions

## Supabase Setup Required

### Storage Bucket
```
Name: baby-avatars
Public: Yes
File size limit: 2MB
Allowed MIME types: image/jpeg, image/png, image/webp
```

### Database Migration
```sql
ALTER TABLE profiles ADD COLUMN baby_avatar_url TEXT;
```

### RLS Policies for sleep_entries (shared users)
```sql
-- Allow caregivers to read/write entries for shared babies
-- See full SQL in conversation
```

### RLS Policy for baby_shares
```sql
CREATE POLICY "Owners can update their shares" ON baby_shares
FOR UPDATE USING (baby_owner_id = auth.uid());
```

## Design Decisions
- **Bottom sheet for editing**: Chosen over inline editing for cleaner list UI and native mobile feel
- **Image compression**: Client-side to avoid friction; users can upload any size photo
- **Role descriptions**: "Can add and edit entries" vs "Can only view entries" for clarity

## Commits
1. `feat: add baby profile picture with client-side image compression`
2. `feat: add role selector (caregiver/viewer) when inviting users`
3. `feat: allow editing roles for existing shared users`
4. `feat: improve share access UI with bottom sheet pattern`
