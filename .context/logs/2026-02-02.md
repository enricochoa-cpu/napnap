# Daily Log: 2026-02-02

## Summary
Día enfocado en **premium motion physics** y **code cleanup**. La app ahora tiene transiciones fluidas tipo app nativa y se eliminó código muerto acumulado.

---

## Features Implemented

### 1. AnimatePresence Route Transitions
**Files:** `App.tsx`

- Añadido tracking de `previousView` con `useRef` para calcular dirección del slide
- Wrapper `<AnimatePresence mode="wait">` en el contenido principal
- Spring physics: `stiffness: 300, damping: 30`
- Dirección calculada según orden de vistas: `['home', 'history', 'stats', 'profile']`

### 2. SleepEntrySheet Drag-to-Dismiss
**Files:** `SleepEntrySheet.tsx`

- Migrado de CSS `.slide-up` a Framer Motion `motion.div`
- `drag="y"` con `dragElastic={{ top: 0, bottom: 0.6 }}`
- Dismiss automático si `offset.y > 150px` o `velocity.y > 500`
- Backdrop opacity sincronizada con drag position (`useTransform`)
- Icono con micro-animación de entrada (scale 0.8 → 1)
- Cambiado `50vh` → `50dvh` para viewport dinámico

### 3. Skeleton Loading States
**Files:** `SkeletonTimelineCard.tsx` (nuevo), `TodayView.tsx`

- `SkeletonTimelineCard`: altura exacta 48px (igual que Compact Cards)
- `SkeletonTimeline`: layout con 4 cards placeholder
- `SkeletonHero`: placeholder para countdown central
- Integrado en TodayView con prop `loading?: boolean`

---

## Bugs Fixed

### 1. Predicted Nap Durante Nap Activa
**Problema:** Con una nap en curso a las 13:30, se mostraba "Predicted Nap 15:05" (solapando)

**Causa:** `todayNaps` solo contaba naps completadas (`endTime !== null`). El algoritmo pensaba que solo había 1 nap y predecía la 2ª, sin saber que ya estaba en curso.

**Solución:** (`TodayView.tsx`)
```typescript
const effectiveNapCount = todayNaps.length + (hasActiveNap ? 1 : 0);
// Usar expectedWakeTime como anchor para predicciones
// Filtrar predicciones antes del expected wake
```

### 2. Scroll Position en Profile Navigation
**Problema:** Al navegar de ProfileMenu a AccountSettings, el scroll se mantenía

**Solución:** (`ProfileSection.tsx`)
```typescript
useEffect(() => {
  window.scrollTo(0, 0);
}, [currentView]);
```

---

## Code Cleanup

### Files Deleted (547 lines)
| File | Reason |
|------|--------|
| `ActiveSleep.tsx` | Reemplazado por UI inline en TodayView |
| `SleepForm.tsx` | Reemplazado por SleepEntrySheet |
| `Starfield.tsx` | SkyBackground tiene implementación inline |

### Exports Removed
- `SleepEntry.tsx`: `MilestoneCard` (alias legacy), `SleepEntryCard` (wrapper sin uso)
- `LoadingScreen.tsx`: `Loader`, `Spinner` (nunca importados)

---

## Documentation Updates

- `CLAUDE.md`: Actualizado con nuevos componentes y eliminados
- `memory/MEMORY.md`: Reestructurado con tablas, añadidas secciones de Animation Standards y Architecture Reference

---

## Commits

| Hash | Message |
|------|---------|
| `76ad7c4` | Add premium motion physics and skeleton loading states |
| `7f565e9` | Fix predicted naps showing during active nap |
| `80ffeac` | chore: remove dead code and unused exports |
| `956f5c5` | docs: update CLAUDE.md after dead code removal |

---

## Notes & Decisions

- **Predicciones visibles durante nap activa**: Decisión de mostrar predicciones futuras incluso cuando hay nap en curso (antes se ocultaban todas). Permite al usuario ver "qué viene después" mientras el bebé duerme.

- **Drag-to-dismiss threshold**: 150px offset o 500px/s velocity. Valores calibrados para sentirse natural en móvil sin dismisses accidentales.

- **Sistema de memoria**: Creado `memory/MEMORY.md` como "cerebro" persistente y `docs/memory/YYYY-MM-DD.md` para daily logs.

---

## Memory System Reorganization

### Changes
Unificación del sistema de memoria en carpeta `.context/`:

| From | To |
|------|----|
| `memory/MEMORY.md` | `.context/MEMORY.md` |
| `docs/memory/2026-02-02.md` | `.context/logs/2026-02-02.md` |
| (new) | `.context/rules.md` |

### Structure
```
.context/
├── MEMORY.md      # Project DNA, architectural decisions
├── rules.md       # Coding standards extracted from CLAUDE.md
└── logs/
    └── YYYY-MM-DD.md  # Daily session logs
```

### rules.md Contents
Extracted coding guidelines from CLAUDE.md:
1. Think Before Coding
2. Simplicity First
3. Surgical Changes
4. Goal-Driven Execution
5. Bug Fixes: Prove It Pattern
6. Memory Protocol (auto-log, auto-update)

---

## UI/UX Improvements

### 1. Input Styling (iOS Settings Style)
**Files:** `src/index.css`

- Eliminado borde de inputs (`.input { border: none }`)
- Focus state: background cambia a `--bg-elevated` + inset ring teal
- Transiciones suaves para background y box-shadow

### 2. MenuCard Border Fix
**Files:** `ProfileMenu.tsx`

**Problema:** Cards usaban `border-[var(--border-subtle)]` pero la variable no existía → borde negro default

**Solución:** Reemplazado por `shadow-sm hover:shadow-md` sin bordes

---

## Stats Page with Recharts

### New Component: StatsView
**Files:** `src/components/StatsView.tsx`

Página de estadísticas con gráficas elegantes usando Recharts.

**Features:**
- **Date Range Picker**: Selector From/To con formato DD-MM, YYYY, máximo 15 días
- **Summary Cards**: Avg Total Sleep, Avg Naps/Day, Avg Nap Time, Avg Night Sleep
- **Bar Chart**: Daily sleep stacked (naps + night) con gradientes
- **Area Chart**: Sleep trends con líneas suaves

**Implementación:**
- Botones custom que abren date picker nativo via `showPicker()`
- Input oculto con `sr-only` para accesibilidad
- Tooltips personalizados con estilo de la app
- Colores via CSS variables (`--nap-color`, `--night-color`)
- Estado vacío cuando no hay datos

**Dependencias añadidas:**
- `recharts` (~45kb bundled)

---

*Next steps: Considerar haptic feedback (Vibration API para Android), pull-to-refresh personalizado.*
