# 2026-02-04: Algorithm Status Card + Overdue Nap Fix

## Features Implemented

### 1. AlgorithmStatusCard Component
New component in Profile section showing algorithm maturity and educational content.

**Files created:**
- `src/components/Profile/AlgorithmStatusCard.tsx`

**Files modified:**
- `src/components/Profile/ProfileMenu.tsx` - Added algorithmStatus prop and renders card
- `src/components/Profile/ProfileSection.tsx` - Prop passthrough
- `src/components/Profile/index.tsx` - Export new component
- `src/App.tsx` - Computes algorithm status from entries
- `src/utils/dateUtils.ts` - Added status tier constants and helper

**Features:**
- 3-tier status display: Learning (0-5 entries), Calibrating (6-15), Optimised (15+)
- Timeline progress indicator with icons in circles:
  - Learning: Baby bottle icon
  - Calibrating: Teddy bear icon
  - Optimised: Magic wand icon
- High variability warning when patterns are irregular
- Educational accordion "How NapNap works" explaining the algorithm
- All text in English UK

**New exports from dateUtils.ts:**
```typescript
export const ALGORITHM_STATUS_THRESHOLDS = {
  LEARNING_MAX: 5,
  CALIBRATING_MAX: 15,
};
export type AlgorithmStatusTier = 'learning' | 'calibrating' | 'optimized';
export function getAlgorithmStatusTier(totalEntries: number): AlgorithmStatusTier;
```

---

### 2. Overdue Nap Prediction Bug Fix
Fixed critical bug where bedtime showed impossibly early times when nap predictions were overdue.

**Bug scenario:**
- Wake: 7:40, Nap 1: 9:40-10:20, Nap 2: 12:25-12:54
- At 15:22, bedtime showed 15:54 (should be ~18:30+)

**Root cause:**
1. Algorithm predicted 3rd nap at ~14:54 (last wake + short nap penalty)
2. At 15:22, this prediction was filtered out as "in the past"
3. With no predictions, bedtime fell back to: last nap end (12:54) + final wake window (3h) = 15:54

**Fix in TodayView.tsx:**
When a predicted nap is overdue (in the past) and baby isn't sleeping:
- Show nap as "now" instead of filtering it out entirely
- This ensures parents see the nap is needed immediately
- Bedtime calculates correctly from current time + expected nap + final wake window

**Key learning:** Predictions must handle the case where baby "missed" the optimal nap window. Simply filtering out past predictions causes bedtime to anchor on stale data.

---

### 3. Logout Confirmation Modal (pre-existing)
Added confirmation modal when signing out in AccountSettingsView.

---

## Technical Notes

- Fixed unused parameter warning: `todayWeight` â†’ `_todayWeight` in dateUtils.ts
- All builds pass TypeScript and Vite production build
- No new lint errors introduced

## Files Changed Summary

| File | Change Type |
|------|-------------|
| `src/components/Profile/AlgorithmStatusCard.tsx` | NEW |
| `src/components/Profile/ProfileMenu.tsx` | Modified |
| `src/components/Profile/ProfileSection.tsx` | Modified |
| `src/components/Profile/index.tsx` | Modified |
| `src/components/Profile/AccountSettingsView.tsx` | Modified |
| `src/components/TodayView.tsx` | Modified (overdue nap fix) |
| `src/utils/dateUtils.ts` | Modified |
| `src/App.tsx` | Modified |
