# 2026-02-26 — Go-live Section 3 (Security): search_path migration, RLS anonymized tables, leaked password N/A

## Summary

### Section 3 Security (go-live readiness)

- **3.1 Leaked password protection:** Documented as N/A (nice to have). Feature requires Supabase Pro plan; not enabled on free tier. Go-live doc updated with exact dashboard path (Auth → Providers → Email) for when/if upgrading to Pro. Q11 answered.
- **3.2 Function search_path:** Migration `20260226000000_function_search_path.sql` added. Sets `search_path = public` on `link_my_pending_invitations()` to satisfy Supabase linter 0011 (prevents search_path injection on SECURITY DEFINER functions). User applied migration.
- **3.3 RLS on anonymized tables:** Migration `20260226000001_anonymized_tables_rls_service_role_only.sql` added. Dropped policies "Authenticated can insert anonymized_baby_profiles", "Authenticated can insert anonymized_sleep_entries", "Authenticated can select anonymized_baby_profiles". Only service role (e.g. delete-account Edge Function) can read/write those tables. Client `useBabyProfile.deleteProfile` no longer inserts into anonymized tables; only full account delete anonymizes (via Edge Function). User applied migration.

### Doc updates

- **product-research/go-live-readiness.md:** §3.1 status and Q11 (leaked password = N/A, nice to have); §3.2/§3.3 marked Done with migration names; checklist and Next steps updated (Security: leaked N/A, search_path Done, RLS Done).

## Technical notes

- **Migrations:** Both run in order; no code dependency on client INSERT to anonymized_* (delete-account Edge Function uses service role and bypasses RLS).
- **useBabyProfile.deleteProfile:** Removed client-side anonymization block (insert into anonymized_baby_profiles / anonymized_sleep_entries). Single-baby delete now only deletes avatars, sleep_entries, and profile row. Comment added explaining that anonymization is only on full account delete via Edge Function.
