# 2026-02-10 — DayNavigator Redesign (Napper-style Week Strip + Calendar Modal)

## Cambios Realizados

### 1. DayNavigator Complete Rewrite (`src/components/DayNavigator.tsx`)
Replaced the basic prev/next arrow navigator with a premium Napper-style week strip + calendar modal.

**Old design:** Two arrow buttons flanking a date label + native `<input type="date">` + "Today" text button.

**New design — 3 sections:**

#### 1.1 Date Header (tappable)
- Displays "Today" or "February 10" with a down chevron (▾)
- Baby age shown below in muted text
- Tapping opens the calendar modal

#### 1.2 Week Strip (`WeekStrip` sub-component)
- 7-day grid (Mon–Sun) using `startOfWeek(selectedDate, { weekStartsOn: 1 })`
- Day letter (`format(day, 'EEEEE')` → M, T, W...) + day number circle
- Selected day: `bg-[var(--nap-color)]` circle with `text-[var(--text-on-accent)]`, day letter in `text-[var(--nap-color)]`
- Today (unselected): subtle `ring-1 ring-[var(--text-muted)]`
- Entry dots: 4px `bg-[var(--text-primary)]` circle below days with data in `datesWithEntries`
- Swipeable: `motion.div` with `drag="x"`, swipe left/right navigates ±1 week
- `AnimatePresence` slide animation on week change

#### 1.3 Calendar Modal (`CalendarModal` sub-component)
- Bottom sheet following `SleepEntrySheet` pattern: spring (damping: 25, stiffness: 300), drag-to-dismiss
- Backdrop: `bg-black/50 backdrop-blur-sm`, inline `zIndex: 100` (critical — see lessons)
- Month navigation: `< February 2026 >` with arrow buttons
- Calendar grid: `grid grid-cols-7`, Mon-start layout
- Days outside current month: `opacity-20`
- Selected day: accent circle, today: subtle ring, entry dots on days with data
- Footer: "Back to today" accent button + "Close" muted text button
- Extra `pb-28` on footer to clear the floating nav bar

### 2. App.tsx Props Wiring
- Added `calculateAge` to imports from `dateUtils`
- New `useMemo`: `datesWithEntries` — `Set<string>` of all entry dates (for calendar dots)
- New `useMemo`: `babyAge` — computed from `activeBabyProfile || profile` via `calculateAge()`
- Updated `<DayNavigator>` in `renderHistoryView` to pass `babyAge` and `datesWithEntries`

### 3. Bug Fixes
- **Day letter colour on selected day**: Was `text-[var(--text-on-accent)]` (dark text on dark bg = invisible). Fixed to `text-[var(--nap-color)]` (accent colour, visible on all themes).
- **Calendar modal z-index**: Nav bar (`z-index: 50` in CSS) covered the calendar modal's footer buttons. Tailwind `z-[60]` class did NOT override the CSS z-index (likely a Tailwind v4 specificity issue). Fixed with inline `style={{ zIndex: 100 }}` on both backdrop and sheet.

## Decisiones Arquitecturales

### Inline `zIndex` over Tailwind Class for Critical Overlays
**Decision:** Use inline `style={{ zIndex: 100 }}` instead of Tailwind `z-[60]` for modals that must appear above the floating nav bar.
**Rationale:** The nav bar's `z-index: 50` is defined in CSS (`.floating-nav`). Tailwind v4 arbitrary `z-[60]` did not reliably override it — possibly due to CSS specificity or cascade ordering. Inline styles guarantee the value is applied. SleepEntrySheet already uses `z-50` in Tailwind and works (it's defined in JSX alongside the nav, not competing with CSS classes), but for safety, all new modals should use inline zIndex.

### Extra Bottom Padding Instead of Hiding Nav
**Decision:** Added `pb-28` to the calendar modal footer instead of hiding the nav bar while the modal is open.
**Rationale:** Simpler implementation with no state coupling between the calendar and the nav. The generous padding ensures buttons are always accessible regardless of nav bar height or safe area insets.

## Pendientes

- [ ] Delete Account button is a TODO (does nothing)
- [ ] Resend domain verification for production invitation emails
- [ ] Delete baby functionality (currently shows confirmation but doesn't delete)
